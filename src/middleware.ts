import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({ request })\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) =>\n            request.cookies.set(name, value)\n          )\n          supabaseResponse = NextResponse.next({ request })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n  const { data: { user } } = await supabase.auth.getUser()\n  if (request.nextUrl.pathname.startsWith('/auth/accept-invite')) {\n    return supabaseResponse\n  }\n  if (request.nextUrl.pathname.startsWith('/auth/signout')) {\n    return supabaseResponse\n  }\n  if (!user && request.nextUrl.pathname.startsWith('/dashboard')) {\n    return NextResponse.redirect(new URL('/auth/login', request.url))\n  }\n  if (user && request.nextUrl.pathname.startsWith('/auth')) {\n    return NextResponse.redirect(new URL('/dashboard', request.url))\n  }\n  return supabaseResponse\n}\n\nexport const config = {\n  matcher: ['/dashboard/:path*', '/auth/:path*'],\n}