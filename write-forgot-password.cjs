const fs = require('fs');

const forgotPage = [
  "'use client'",
  "",
  "import { useState } from 'react'",
  "import Link from 'next/link'",
  "import { createClient } from '@/lib/supabase/client'",
  "",
  "export default function ForgotPasswordPage() {",
  "  const [email, setEmail] = useState('')",
  "  const [loading, setLoading] = useState(false)",
  "  const [sent, setSent] = useState(false)",
  "  const [error, setError] = useState<string | null>(null)",
  "  const supabase = createClient()",
  "",
  "  async function handleSubmit() {",
  "    setLoading(true)",
  "    setError(null)",
  "    const { error } = await supabase.auth.resetPasswordForEmail(email, {",
  "      redirectTo: window.location.origin + '/auth/reset-password'",
  "    })",
  "    if (error) {",
  "      setError(error.message)",
  "    } else {",
  "      setSent(true)",
  "    }",
  "    setLoading(false)",
  "  }",
  "",
  "  return (",
  "    <main className='min-h-screen bg-stone-50 flex items-center justify-center px-4'>",
  "      <div className='w-full max-w-md'>",
  "        <div className='text-center mb-8'>",
  "          <div className='text-4xl mb-3'>üïäÔ∏è</div>",
  "          <h1 className='text-2xl font-semibold text-stone-800'>Reset your password</h1>",
  "          <p className='text-stone-500 mt-1'>Enter your email and we'll send you a link</p>",
  "        </div>",
  "        <div className='bg-white rounded-xl shadow-sm border border-stone-200 p-8'>",
  "          {sent ? (",
  "            <div className='text-center'>",
  "              <div className='text-4xl mb-4'>üì¨</div>",
  "              <p className='text-stone-700 font-medium'>Check your email!</p>",
  "              <p className='text-stone-500 text-sm mt-2'>We sent a password reset link to {email}</p>",
  "              <Link href='/auth/login' className='mt-6 block text-center text-stone-500 text-sm hover:text-stone-800'>Back to login</Link>",
  "            </div>",
  "          ) : (",
  "            <div className='space-y-5'>",
  "              <div>",
  "                <label className='block text-sm font-medium text-stone-700 mb-1'>Email address</label>",
  "                <input value={email} onChange={e => setEmail(e.target.value)} type='email' placeholder='jane@example.com' className='w-full border border-stone-300 rounded-lg px-4 py-2.5 text-stone-800 placeholder-stone-400 focus:outline-none focus:ring-2 focus:ring-stone-400' />",
  "              </div>",
  "              {error && <p className='text-red-600 text-sm bg-red-50 border border-red-200 rounded-lg px-4 py-2'>{error}</p>}",
  "              <button onClick={handleSubmit} disabled={loading || !email} className='w-full bg-stone-800 text-white py-3 rounded-lg font-medium hover:bg-stone-700 transition-colors disabled:opacity-50'>",
  "                {loading ? 'Sending...' : 'Send reset link'}",
  "              </button>",
  "              <Link href='/auth/login' className='block text-center text-stone-500 text-sm hover:text-stone-800'>Back to login</Link>",
  "            </div>",
  "          )}",
  "        </div>",
  "      </div>",
  "    </main>",
  "  )",
  "}"
].join('\n');

const resetPage = [
  "'use client'",
  "",
  "import { useState, useEffect } from 'react'",
  "import { useRouter } from 'next/navigation'",
  "import { createClient } from '@/lib/supabase/client'",
  "",
  "export default function ResetPasswordPage() {",
  "  const [password, setPassword] = useState('')",
  "  const [loading, setLoading] = useState(false)",
  "  const [error, setError] = useState<string | null>(null)",
  "  const [ready, setReady] = useState(false)",
  "  const router = useRouter()",
  "  const supabase = createClient()",
  "",
  "  useEffect(() => {",
  "    const hash = window.location.hash",
  "    if (hash) {",
  "      const params = new URLSearchParams(hash.substring(1))",
  "      const accessToken = params.get('access_token')",
  "      const refreshToken = params.get('refresh_token')",
  "      if (accessToken && refreshToken) {",
  "        supabase.auth.setSession({ access_token: accessToken, refresh_token: refreshToken }).then(() => {",
  "          setReady(true)",
  "        })",
  "      }",
  "    }",
  "  }, [])",
  "",
  "  async function handleReset() {",
  "    setLoading(true)",
  "    setError(null)",
  "    const { error } = await supabase.auth.updateUser({ password })",
  "    if (error) {",
  "      setError(error.message)",
  "      setLoading(false)",
  "      return",
  "    }",
  "    router.push('/dashboard')",
  "  }",
  "",
  "  return (",
  "    <main className='min-h-screen bg-stone-50 flex items-center justify-center px-4'>",
  "      <div className='w-full max-w-md'>",
  "        <div className='text-center mb-8'>",
  "          <div className='text-4xl mb-3'>üïäÔ∏è</div>",
  "          <h1 className='text-2xl font-semibold text-stone-800'>Set new password</h1>",
  "          <p className='text-stone-500 mt-1'>Choose a new password for your account</p>",
  "        </div>",
  "        <div className='bg-white rounded-xl shadow-sm border border-stone-200 p-8'>",
  "          {!ready ? (",
  "            <p className='text-stone-500 text-center'>Loading...</p>",
  "          ) : (",
  "            <div className='space-y-5'>",
  "              <div>",
  "                <label className='block text-sm font-medium text-stone-700 mb-1'>New password</label>",
  "                <input value={password} onChange={e => setPassword(e.target.value)} type='password' placeholder='At least 8 characters' minLength={8} className='w-full border border-stone-300 rounded-lg px-4 py-2.5 text-stone-800 placeholder-stone-400 focus:outline-none focus:ring-2 focus:ring-stone-400' />",
  "              </div>",
  "              {error && <p className='text-red-600 text-sm bg-red-50 border border-red-200 rounded-lg px-4 py-2'>{error}</p>}",
  "              <button onClick={handleReset} disabled={loading || password.length < 8} className='w-full bg-stone-800 text-white py-3 rounded-lg font-medium hover:bg-stone-700 transition-colors disabled:opacity-50'>",
  "                {loading ? 'Updating...' : 'Update password'}",
  "              </button>",
  "            </div>",
  "          )}",
  "        </div>",
  "      </div>",
  "    </main>",
  "  )",
  "}"
].join('\n');

fs.mkdirSync('src/app/auth/forgot-password', { recursive: true });
fs.mkdirSync('src/app/auth/reset-password', { recursive: true });
fs.writeFileSync('src/app/auth/forgot-password/page.tsx', forgotPage);
fs.writeFileSync('src/app/auth/reset-password/page.tsx', resetPage);
console.log('All done!');
console.log('forgot-password: ' + fs.statSync('src/app/auth/forgot-password/page.tsx').size);
console.log('reset-password: ' + fs.statSync('src/app/auth/reset-password/page.tsx').size);
